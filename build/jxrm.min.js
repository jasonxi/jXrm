/*! jxrm 2020-02-10 */
/*! https://github.com/jasonxi/jXrm */

!function(){var e,t,n,i,r,s,o,a,u,c,f,l,g,d;function h(){this.items=[]}function m(){return Xrm.Utility.getGlobalContext?Xrm.Utility.getGlobalContext():Xrm.Page.context}function b(t,e,n){c.getFormContext(e).ui.controls.get().forEach(function(e){(!t||t.indexOf(e.getName())<0)&&e.setDisabled&&e.setDisabled(n)})}function p(e,n,i){e.split(",").forEach(function(e){var t=c.getFormContext(n).ui.tabs.get(e.replace(" ",""));t&&t.setVisible(i)})}function x(e,t,n,i){var r=c.getFormContext(n).ui.tabs.get(e);if(r){var s=r.sections.get(t);s&&s.setVisible(i)}}"undefined"==typeof Xrm&&(window.Xrm={__namespace:!0}),Xrm,e=function(){var e="[\\x20\\t\\r\\n\\f]",t="(?:\\\\[\\da-fA-F]{1,6}"+e+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",r=(new RegExp(e+"+","g"),new RegExp("^"+e+"+|((?:^|[^\\\\])(?:\\\\.)*)"+e+"+$","g")),s=(new RegExp("^"+e+"*,"+e+"*"),new RegExp("^"+e+"*([>+~]|"+e+")"+e+"*"),new RegExp(e+"|>"),new RegExp(":((?:\\\\[\\da-fA-F]{1,6}[\\x20\\t\\r\\n\\f]?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+)(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|\\[[\\x20\\t\\r\\n\\f]*((?:\\\\[\\da-fA-F]{1,6}[\\x20\\t\\r\\n\\f]?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+)(?:[\\x20\\t\\r\\n\\f]*([*^$|!~]?=)[\\x20\\t\\r\\n\\f]*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|((?:\\\\[\\da-fA-F]{1,6}[\\x20\\t\\r\\n\\f]?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+))|)[\\x20\\t\\r\\n\\f]*\\])*)|.*)\\)|)"),new RegExp("^"+t+"$"),{ID:new RegExp("^#("+t+")"),TAB:new RegExp("^(?:tab|t)"+e+"#("+t+")","i"),SECTION:new RegExp("^(?:section|s|sec)"+e+"#("+t+")","i")});new RegExp("\\\\[\\da-fA-F]{1,6}"+e+"?|\\\\([^\\r\\n\\f])","g");return{parse:function(e,t){var n,i=[];return null!=e&&""!=e&&e.split(",").forEach(function(e){for(var t in e=e.replace(r,""),s)if(n=s[t].exec(e)){i.push({type:t,value:n.shift(),id:n.shift().toLowerCase()});break}}),i}}}(),h.prototype={exec:function(t){if(0===this.items.length||!t)return null;if(1===this.items.length&&t)return t(this.items[0]);if(1<this.items.length&&t){var n={};return this.items.forEach(function(e){n[e.getName()]=t(e)}),n}},push:function(e){this.items.push(e)},get first(){return 0<this.items.length?this.items[0]:null},get length(){return this.items.length}},n=function(e,s,o,t){"undefined"==typeof jXrm&&(jXrm={__namespace:!0});function a(e){return e&&e.getFormContext?e.getFormContext():jXrm.formContext||Xrm.Page}function i(e,t){var i=this,r=a(t),n=s.parse(e);0<n.length?n.forEach(function(n){switch(n.type){case"ID":i.type="a",i.attributes||(i.attributes=new o,i.controls=new o),i.attributes.push(r.getAttribute(n.id)),i.controls.push(r.getControl(n.id));break;case"TAB":i.type="t",i.tabs||(i.tabs=new o),i.tabs.push(r.ui.tabs.get(n.id));break;case"SECTION":i.type="s",i.sections||(i.sections=new o);var e=r.ui.tabs.get();e&&e.forEach(function(e){var t=e.sections.get(n.id);t&&i.sections.push(t)})}}):console.log("Invalid selector.")}return jXrm=function(e,t){var n=new i(e,t);switch(n.type){case"a":n.__proto__=jXrm.fn0;break;case"t":n.__proto__=jXrm.fn1;break;case"s":n.__proto__=jXrm.fn2}return n},jXrm.fn0={},jXrm.fn1={},jXrm.fn2={},jXrm.fn=jXrm.prototype={version:"0.03"},t.extend(jXrm,{getFormContext:a,set executionContext(e){jXrm.formContext=a(e)},enum:{}}),jXrm}(0,e,h,t={extend:function(e,t){"function"!=typeof Object.assign&&(Object.assign=function(e,t){"use strict";if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),i=1;i<arguments.length;i++){var r=arguments[i];if(null!=r)for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(n[s]=r[s])}return n}),Object.assign(e,t)},toObject:function(t,e){return t=t||{},e.forEach(function(e){if(null!==e){var i=e.split("|");i[1]||(i[1]=i[0]),t[i[0]]=function(){var e=null;switch(i[2]){case"a":e=this.attributes;break;case"c":e=this.controls;break;case"t":e=this.tabs;break;case"s":e=this.sections}for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(i[4]&&(t[0]="1"===i[4]||"0"!==i[4]&&i[4]),e)return i[3]?e.exec(function(e){return e&&e[i[1]]?e[i[1]].apply(e,t):null}):(e.exec(function(e){e&&e[i[1]]&&e[i[1]].apply(e,t)}),this)}}}),t}}),i={AlertOpts:{width:450,height:150},ConfirmOpts:{width:450,height:200}},(r=n).context={get userId(){var e=m();return e.userSettings?e.userSettings.userId:e.getUserId()},get userName(){var e=m();return e.userSettings?e.userSettings.userName:e.getUserName()},get roles(){var e=m();return e.userSettings?e.userSettings.securityRoles:e.getUserRoles()},get clientUrl(){var e=m();return e.getClientUrl?e.getClientUrl():void 0},get isOffline(){var e=m();return e.client?e.client.isOffline():void 0}},function(e,t){t.extend(e.enum,{RequiredLevel:{None:"none",Required:"required",Recommended:"recommended"},SubmitMode:{Always:"always",Never:"never",Dirty:"dirty"}});t.toObject(e.fn0,["getType|getAttributeType|a|1","isDirty|getIsDirty|a|1","isPartyList|getIsPartyList|a|1","isValid||a|1","maxLength|getMaxLength|a|1","getRequiredLevel||a|1","setRequiredLevel||a","required|setRequiredLevel|a||required","recommended|setRequiredLevel|a||recommended","optional|setRequiredLevel|a||none","getSubmitMode||a|1","setSubmitMode||a","getVisible||c|1","setVisible||c","show|setVisible|c||1","hide|setVisible|c||0","parent|getParent|a|1","getPrivilege|getUserPrivilege|a|1","change|addOnChange|a","removeOnChange||a","fireOnChange||a","getOption||a|1","getOptions||a|1","disable|setDisabled|c||1","enable|setDisabled|c||0","addCustomFilter||c","addPreSearch||c","removePreSearch||c"]),t.extend(e.fn0,{val:function(t,n){return void 0===t?this.attributes.exec(function(e){return e&&e.getValue?e.getValue():null}):(this.attributes.exec(function(e){e&&e.setValue&&e.setValue(t),!0===n&&e.fireOnChange()}),this)},focus:function(){return this.controls.first&&this.controls.first.setFocus&&this.controls.first.setFocus(),this},toggleVisible:function(){return this.controls.exec(function(e){e&&e.setVisible&&e.setVisible(!e.getVsible())}),this},on:function(e,t){},filter:function(t,n){return this.controls.exec(function(e){e&&e.addPreSearch&&e.addPreSearch(function(){e.addCustomFilter(n,t)})}),this}})}(n,t),(o=t).toObject((s=n).fn1,["setVisible||t","show|setVisible|t||1","hide|setVisible|t||0","disable|setDisabled|t||1","enable|setDisabled|t||0"]),o.extend(s.fn1,{toggleVisible:function(){return this.tabs.exec(function(e){e&&e.setVisible&&e.setVisible(!e.getVsible())}),this}}),(u=t).toObject((a=n).fn2,["setVisible||s","show|setVisible|s||1","hide|setVisible|s||0","disable|setDisabled|s||1","enable|setDisabled|s||0"]),u.extend(a.fn2,{toggleVisible:function(){return this.sections.exec(function(e){e&&e.setVisible&&e.setVisible(!e.getVsible())}),this}}),l=i,(f=t).extend(c=n,{alert:function(e,t,n,i){var r="string"==typeof e?{text:e}:e,s=l.AlertOpts;f.extend(s,i),Xrm.Navigation.openAlertDialog(r,s).then(t,n)},confirm:function(e,t,n,i,r){var s="string"==typeof e?{text:e}:e,o=l.ConfirmOpts;f.extend(o,r),Xrm.Navigation.openConfirmDialog(s,o).then(function(e){e.confirmed&&(t?t():n&&n())},i)},openForm:function(e,t,n,i,r,s){var o={entityName:e,entityId:t};s&&f.extend(o,s),Xrm.Navigation.openForm(o,n).then(i,r)},openFile:function(e,t){Xrm.Navigation.openFile(e,t)},openUrl:function(e,t){Xrm.Navigation.openUrl(e,t)},openWebResource:function(e,t,n){Xrm.Navigation.openWebResource(e,t,n)},disableForm:function(e,t){b(e,t,!0)},enableForm:function(e,t){b(e,t,!1)},showTab:function(e,t){p(e,t,!0)},hideTab:function(e,t){p(e,t,!1)},showSection:function(e,t,n){x(e,t,n,!0)},hideSection:function(e,t,n){x(e,t,n,!1)},getFormType:function(e){return c.getFormContext(e).ui.getFormType()}}),t.extend(g=n,{save:function(e,t,n){return g.getFormContext(n).data.save().then(e,t),this},refresh:function(e,t,n,i){return g.getFormContext(i).data.refresh(e).then(t,n),this},addOnLoad:function(e,t){return g.getFormContext(t).data.addOnLoad(e),this}}),d=n,window.jXrm=d}();